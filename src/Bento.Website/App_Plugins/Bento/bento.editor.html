<!-- This is the "Bento Item" template -->
<div ng-controller="bento.editor.controller as vm">
	<link ng-repeat="url in vm.cssFonts" data-ng-if="url" rel="stylesheet" data-ng-href="{{vm.trustSrc(url)}}" />
	<ng-form name="bentoEditorForm">
		<div class="bento-stack-item umb-box bento-layout-wrapper">
			<div class="umb-box-header bento-stack-item-handle no-grab">
				<div ng-if="!vm.canAddMultiple()"><i class="icon {{ vm.icon }}"></i> {{ vm.item.name }}</div>
				<div ng-if="vm.canAddMultiple()"><i class="icon {{ vm.icon }}"></i> {{ vm.item.contents.length }} Item{{ vm.item.contents.length == 0 || vm.item.contents.length > 1 ? 's' : '' }}</div>
				<div class="bento-stack-item-tools" ng-if="vm.item.id !== undefined">
					<div style="position:relative;">
						<a href="" ng-click="vm.toggleDeleteConfirm(true)"><i class="umb-control-tool-icon icon-trash"></i></a>
						<umb-confirm-action ng-if="vm.deleteConfirmVisible"
											direction="left"
											on-confirm="vm.remove()"
											on-cancel="vm.toggleDeleteConfirm(false)">
						</umb-confirm-action>
					</div>
				</div>
			</div>
			<div class="content">
				<div ng-repeat="areaItem in vm.item.contents">
					<div class="action-buttons" ng-if="vm.canAddMultiple()">
						<!-- ToDo: Use a bento-block-inserter to replicate the layouts hover functionality (to make this behave as an insert above) -->
					</div>
					<bento-block-picker updating="vm.updating" id="areaItem.id" key="areaItem.key" content-node="areaItem.contentNode" content-data="areaItem.contentData" icon="areaItem.icon" content-name="areaItem.name" config="vm.config" index="$index" area="vm.item"></bento-block-picker>
				</div>
				<bento-block-inserter ng-if="vm.canAddContent()" updating="vm.updating" config="vm.config" area="vm.item"></bento-block-inserter>
			</div>
		</div>
        <!--These are here because we need ng-form fields to validate against -->
        <input type="hidden" name="minCount" ng-model="vm.item.contents" />
        <input type="hidden" name="maxCount" ng-model="vm.item.contents" />
        <div ng-messages="bentoEditorForm.minCount.$error" show-validation-on-submit>
            <div class="help-inline" ng-message="minCount">
                <localize key="validation_minCount">You need to add at least</localize> {{model.config.minNumber}} <localize key="validation_items">item(s)</localize>
            </div>
        </div>
        <div ng-messages="bentoEditorForm.maxCount.$error" show-validation-on-submit>
            <div class="help-inline" ng-message="maxCount">
                <localize key="validation_maxCount">You can only have</localize> {{model.config.maxNumber}} <localize key="validation_items">item(s)</localize>
            </div>
        </div>
	</ng-form>
</div>
